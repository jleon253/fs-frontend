import{m as ge,n as be,o as fe,q as he}from"./chunk-PKNDNEM6.js";import{$ as u,Aa as ne,Ab as me,C as a,Cb as pe,Fa as oe,Ha as ie,Ia as E,K as _,R as Z,S as b,Sa as re,T as f,Ua as ce,W as B,X as H,Y as g,Z as r,_ as c,aa as v,ba as T,ca as K,d as D,da as M,e as x,fb as j,ga as p,ha as X,i as L,ia as h,ib as ae,j as $,k as N,ka as Y,kb as V,la as W,lb as F,ma as J,n as I,oa as ee,pa as C,pb as se,qb as de,r as l,ra as s,s as A,sa as S,t as w,ta as O,u as G,ua as k,va as P,x as m,xb as ue,yb as le,za as te}from"./chunk-GJIYDO4A.js";var y=class o{http=l(re);apiUrl=`${ge.apiUrl}/accounts`;accountChangedSource=new x;accountChanged$=this.accountChangedSource.asObservable();#e=m([]);accounts=this.#e.asReadonly();getAccounts(t=1,n=5,e,i=""){let d={page:t.toString(),limit:n.toString(),search:i};return e&&(d.document_number=e),this.http.get(this.apiUrl,{params:d}).pipe(N(ye=>this.#e.set(ye.data)))}createAccount(t=""){return this.http.post(this.apiUrl,{document_number:t}).pipe(N(n=>{this.#e.update(e=>[n.data,...e]),this.accountChangedSource.next()}))}updateStatus(t,n){return this.http.patch(`${this.apiUrl}/${t}/status`,{status:n}).pipe(N(()=>this.accountChangedSource.next()))}clearLocalAccounts(){this.#e.set([])}static \u0275fac=function(n){return new(n||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};var Q=(n=>(n.ACTIVE="ACTIVE",n.INACTIVE="INACTIVE",n))(Q||{});var q=class{_document;_textarea;constructor(t,n){this._document=n;let e=this._textarea=this._document.createElement("textarea"),i=e.style;i.position="fixed",i.top=i.opacity="0",i.left="-999em",e.setAttribute("aria-hidden","true"),e.value=t,e.readOnly=!0,(this._document.fullscreenElement||this._document.body).appendChild(e)}copy(){let t=this._textarea,n=!1;try{if(t){let e=this._document.activeElement;t.select(),t.setSelectionRange(0,t.value.length),n=this._document.execCommand("copy"),e&&e.focus()}}catch{}return n}destroy(){let t=this._textarea;t&&(t.remove(),this._textarea=void 0)}},Ce=(()=>{class o{_document=l(G);constructor(){}copy(n){let e=this.beginCopy(n),i=e.copy();return e.destroy(),i}beginCopy(n){return new q(n,this._document)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function xe(o,t){o&1&&u(0,"div",10)}function Ae(o,t){o&1&&u(0,"ng-icon",11)}function we(o,t){if(o&1){let n=M();r(0,"button",15),p("click",function(){A(n);let i=h();return w(i.toggleStatus(i.accountStatus.INACTIVE))}),u(1,"ng-icon",16),r(2,"p"),s(3,"Inactivar cuenta"),c()()}}function Te(o,t){if(o&1){let n=M();r(0,"button",17),p("click",function(){A(n);let i=h();return w(i.toggleStatus(i.accountStatus.ACTIVE))}),u(1,"ng-icon",18),r(2,"p"),s(3,"Activar cuenta"),c()()}}var Me={bootstrapThreeDotsVertical:me,bootstrapCheckCircle:se,bootstrapXCircle:pe,bootstrapCopy:de},z=class o{accountStatus=Q;account=E.required();clipboard=l(Ce);accountService=l(y);toastr=l(j);sub=new D;isUpdating=m(!1);copyToClipboard(){this.clipboard.copy(this.account().account_number.toString()),this.toastr.info("N\xFAmero de cuenta copiado al portapapeles","Copiado")}toggleStatus(t){this.isUpdating.set(!0);let n=this.accountService.updateStatus(this.account().id,t).subscribe({next:()=>{this.toastr.success(`Cuenta ${t==="ACTIVE"?"activada":"inactivada"} correctamente`),this.isUpdating.set(!1)},error:()=>{this.toastr.error("Error al cambiar el estado de la cuenta"),this.isUpdating.set(!1)}});this.sub.add(n)}ngOnDestroy(){this.sub.unsubscribe()}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=_({type:o,selectors:[["app-account-row-card"]],inputs:{account:[1,"account"]},features:[P([V(Me)])],decls:20,vars:13,consts:[[1,"account-card-container","d-flex","align-items-center","justify-content-between","p-3","border","rounded","shadow-sm"],[1,"text-uppercase","text-muted","fw-bold","d-block","mb-1",2,"font-size","0.7rem","letter-spacing","0.5px"],[1,"d-flex","align-items-center","gap-2"],[1,"fs-4","fw-bold","font-monospace"],["title","Copy",1,"btn","btn-sm","border-0",3,"click"],["name","bootstrapCopy",1,"me-2"],[1,"d-flex","align-items-center","gap-4"],[1,"badge","rounded-pill","px-3","py-2"],[1,"dropdown"],["type","button","data-bs-toggle","dropdown",1,"btn-actions","border-0","bg-transparent",3,"disabled"],[1,"spinner-border","spinner-border-sm","text-primary"],["name","bootstrapThreeDotsVertical"],[1,"dropdown-menu","dropdown-menu-end","shadow"],[1,"dropdown-item","text-danger"],[1,"dropdown-item","text-success"],[1,"dropdown-item","text-danger",3,"click"],["name","bootstrapXCircle",1,"me-2"],[1,"dropdown-item","text-success",3,"click"],["name","bootstrapCheckCircle",1,"me-2"]],template:function(n,e){n&1&&(r(0,"div",0)(1,"div")(2,"small",1),s(3," Cuenta "),c(),r(4,"div",2)(5,"span",3),s(6),c(),r(7,"button",4),p("click",function(){return e.copyToClipboard()}),u(8,"ng-icon",5),c()()(),r(9,"div",6)(10,"span",7),s(11),c(),r(12,"div",8)(13,"button",9),b(14,xe,1,0,"div",10)(15,Ae,1,0,"ng-icon",11),c(),r(16,"ul",12)(17,"li"),b(18,we,4,0,"button",13)(19,Te,4,0,"button",14),c()()()()()),n&2&&(C("status-active",e.account().status===e.accountStatus.ACTIVE)("status-inactive",e.account().status===e.accountStatus.INACTIVE),a(6),S(e.account().account_number),a(4),C("text-bg-success",e.account().status===e.accountStatus.ACTIVE)("text-bg-danger",e.account().status===e.accountStatus.INACTIVE),a(),O(" ",e.account().status," "),a(2),g("disabled",e.isUpdating()),a(),f(e.isUpdating()?14:15),a(4),f(e.account().status===e.accountStatus.ACTIVE?18:19))},dependencies:[F],styles:["[_nghost-%COMP%]{display:block;margin-bottom:1rem}.account-card-container[_ngcontent-%COMP%]{transition:all .3s ease;border-left:4px solid #dee2e6!important}.account-card-container[_ngcontent-%COMP%]:hover{background-color:var(--bg-mini-card);border-color:#0d6efd!important}.status-active[_ngcontent-%COMP%]{border-left-color:#198754!important}.status-inactive[_ngcontent-%COMP%]{border-left-color:#dc3545!important}.btn-actions[_ngcontent-%COMP%]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background-color .2s;color:#6c757d}.btn-actions[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#0000000d!important;color:#000!important}.btn-actions[_ngcontent-%COMP%]:disabled{cursor:not-allowed}.dropdown-menu[_ngcontent-%COMP%]{box-shadow:0 .5rem 1rem #00000026;border:none;border-radius:8px;padding:.5rem}.dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]{border-radius:4px;padding:.5rem 1rem;font-size:.9rem;display:flex;align-items:center;cursor:pointer}.dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.1rem}.dropdown-menu[_ngcontent-%COMP%]   .dropdown-item[_ngcontent-%COMP%]:active{background-color:#e9ecef!important;color:inherit}.spinner-border-sm[_ngcontent-%COMP%]{width:1.2rem;height:1.2rem;border-width:.15em}"]})};var U=class o{customer=E.required();isSelected=E(!1);selectCustomer=ie();initials=oe(()=>this.customer().full_name.split(" ").map(t=>t[0]).slice(0,2).join("").toUpperCase());onCardClick(t){t.stopPropagation(),this.selectCustomer.emit(this.customer().document_number)}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=_({type:o,selectors:[["app-customer-mini-card"]],inputs:{customer:[1,"customer"],isSelected:[1,"isSelected"]},outputs:{selectCustomer:"selectCustomer"},decls:11,vars:12,consts:[[1,"card","mini-card","mb-2",3,"click","keydown"],[1,"card-body","d-flex","align-items-center","p-2"],[1,"avatar-circle","me-3"],[1,"flex-grow-1","overflow-hidden"],[1,"mb-0","fw-bold","text-truncate"],[1,"text-muted","d-block"],[1,"selection-indicator","ms-2"],[1,"custom-radio"]],template:function(n,e){n&1&&(v(0,"div",0),X("click",function(d){return e.onCardClick(d)})("keydown",function(d){return e.onCardClick(d)}),v(1,"div",1)(2,"div",2),s(3),T(),v(4,"div",3)(5,"p",4),s(6),T(),v(7,"small",5),s(8),T()(),v(9,"div",6),K(10,"div",7),T()()()),n&2&&(C("selected",e.isSelected()),a(2),ee("background-color",e.isSelected()?"#0d6efd":"#6c757d"),a(),O(" ",e.initials()," "),a(2),C("text-primary",e.isSelected()),a(),S(e.customer().full_name),a(2),k("",e.customer().document_type,": ",e.customer().document_number),a(2),C("checked",e.isSelected()))},styles:['.mini-card[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none;border-radius:12px;border:1px solid var(--bs-border-color);transition:all .2s ease}.mini-card[_ngcontent-%COMP%]:hover{background-color:var(--bg-mini-card);border-color:#0d6efd!important}.mini-card.selected[_ngcontent-%COMP%]{border-color:#0d6efd;background-color:var(--bg-mini-card);box-shadow:0 4px 6px #0d6efd1a}.avatar-circle[_ngcontent-%COMP%]{width:40px;height:40px;background:#3e97ff;color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.8rem}.custom-radio[_ngcontent-%COMP%]{width:20px;height:20px;border:2px solid #dee2e6;border-radius:50%;position:relative}.custom-radio.checked[_ngcontent-%COMP%]{border-color:#0d6efd}.custom-radio.checked[_ngcontent-%COMP%]:after{content:"";position:absolute;width:10px;height:10px;background-color:#0d6efd;box-shadow:inset 0 0 0 3px #fff;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%)}']})};var Ee=["customerCard"],ve=(o,t)=>t.id;function De(o,t){o&1&&u(0,"div",5)}function Ne(o,t){o&1&&u(0,"ng-icon",6)}function Ie(o,t){if(o&1){let n=M();r(0,"div",null,0)(2,"app-customer-mini-card",30),p("selectCustomer",function(){let i=A(n).$implicit,d=h();return w(d.selectCustomer(i.document_number))}),c()()}if(o&2){let n=t.$implicit,e=h();Z("data-doc",n.document_number),a(2),g("customer",n)("isSelected",e.selectedDocumentNumber()===n.document_number)}}function Oe(o,t){o&1&&(r(0,"div",9),u(1,"i",31),s(2," No se encontraron clientes "),c())}function ke(o,t){o&1&&(u(0,"span",32),r(1,"span"),s(2,"Procesando..."),c())}function Pe(o,t){o&1&&(u(0,"ng-icon",33),r(1,"span",34),s(2,"Nueva Cuenta"),c())}function je(o,t){if(o&1&&(r(0,"tr",24)(1,"td",35),u(2,"app-account-row-card",36),c()()),o&2){let n=t.$implicit;a(2),g("account",n)}}function Ve(o,t){o&1&&s(0," Seleccione un cliente de la lista para visualizar sus cuentas ")}function Fe(o,t){o&1&&s(0," No se encontraron cuentas que coincidan con los criterios ")}function Re(o,t){if(o&1&&(r(0,"tr")(1,"td",37),b(2,Ve,1,0)(3,Fe,1,0),c()()),o&2){let n=h();a(2),f(!n.selectedDocumentNumber()&&!n.accountSearchTerm()?2:3)}}var ze={bootstrapSearch:le,bootstrapPlusCircle:ue},Se=class o{route=l(ce);toastr=l(j);customerService=l(be);accountService=l(y);customers=this.customerService.customers;accounts=this.accountService.accounts;sub=new D;customerSearchSubject=new x;accountSearchSubject=new x;customerCards;selectedDocumentNumber=m(null);isCreatingAccount=m(!1);page=m(1);pageSize=m(5);totalItems=m(0);isSearching=m(!1);isLoading=m(!1);accountSearchTerm=m("");ngOnInit(){this.getDocumentNumberFromUrl(),this.loadCostumers(),this.loadAccounts(),this.customerSearchConfigure(),this.accountSearchConfigure(),this.listenAccountService()}selectCustomer(t){let n=this.selectedDocumentNumber()===t?null:t;this.selectedDocumentNumber.set(n),n||this.accountSearchTerm.set(""),this.page.set(1),this.loadAccounts()}getDocumentNumberFromUrl(){let t=this.route.snapshot.queryParamMap.get("documentNumber");t&&this.selectedDocumentNumber.set(t),this.selectedDocumentNumber()&&this.scrollToSelectedCustomer()}loadCostumers(){let t=this.customerService.getCustomers(1,100).subscribe();this.sub.add(t)}loadAccounts(){let t=this.selectedDocumentNumber(),n=this.accountSearchTerm();if(!t&&!n){this.accountService.clearLocalAccounts(),this.totalItems.set(0);return}this.isLoading.set(!0);let e=this.accountService.getAccounts(this.page(),this.pageSize(),this.selectedDocumentNumber()||void 0,this.accountSearchTerm()).subscribe({next:i=>{this.totalItems.set(i.meta.total),this.isLoading.set(!1)},error:i=>{this.isLoading.set(!1),this.toastr.error("No se pudo conectar con el servidor","Error de conexi\xF3n"),console.error(i)}});this.sub.add(e)}createAccount(){if(!this.selectedDocumentNumber()){this.toastr.warning("Selecciona un cliente primero, antes de registrar una cuenta.");return}this.isCreatingAccount.set(!0);let t=this.accountService.createAccount(this.selectedDocumentNumber()?.toString()).subscribe({next:()=>{this.toastr.success("Cuenta bancaria registrada con \xE9xito"),this.isCreatingAccount.set(!1),this.loadAccounts()},error:()=>{this.isCreatingAccount.set(!1),this.toastr.error("Error registrando la nueva cuenta")}});this.sub.add(t)}scrollToSelectedCustomer(){setTimeout(()=>{let t=this.selectedDocumentNumber();if(!t)return;let n=this.customerCards.find(e=>e.nativeElement.getAttribute("data-doc")===t);n&&n.nativeElement.scrollIntoView({behavior:"smooth",block:"center"})},100)}onCustomerSearch(t){let n=t.target.value;this.customerSearchSubject.next(n)}performCustomerSearch(t){this.isSearching.set(!0);let n=this.customerService.getCustomers(1,50,t).subscribe({next:()=>this.isSearching.set(!1),error:()=>this.isSearching.set(!1)});this.sub.add(n)}customerSearchConfigure(){this.customerSearchSubject.pipe(L(300),$()).subscribe(t=>{this.performCustomerSearch(t)}),this.sub.add(this.customerSearchSubject)}onAccountSearch(t){let n=t.target.value;this.accountSearchSubject.next(n)}accountSearchConfigure(){this.accountSearchSubject.pipe(L(400),$()).subscribe(t=>{this.accountSearchTerm.set(t),this.page.set(1),this.loadAccounts()}),this.sub.add(this.accountSearchSubject)}listenAccountService(){let t=this.accountService.accountChanged$.subscribe(()=>{this.loadAccounts()});this.sub.add(t)}ngOnDestroy(){this.sub.unsubscribe()}static \u0275fac=function(n){return new(n||o)};static \u0275cmp=_({type:o,selectors:[["app-account-management"]],viewQuery:function(n,e){if(n&1&&Y(Ee,5),n&2){let i;W(i=J())&&(e.customerCards=i)}},features:[P([V(ze)])],decls:44,vars:14,consts:[["customerCard",""],[1,"row","g-4","m-2","mt-0"],[1,"col-12","col-lg-4","mt-0","pt-3","col-left"],[1,"input-group","mb-3"],[1,"input-group-text"],[1,"spinner-border","spinner-border-sm","text-primary"],["name","bootstrapSearch"],["type","text","placeholder","Buscar cliente por nombre o n\xFAmero",1,"form-control","border-start-0","ps-0",3,"input"],[1,"customer-list-scroll"],[1,"text-center","p-4","text-muted","small"],[1,"col-12","col-lg-8"],[1,"card"],[1,"card-header","d-flex","flex-column","justify-content-between","align-items-center","gap-3"],[1,"d-flex","justify-content-between","align-items-center","w-100","gap-2"],[1,"d-flex","justify-content-between","align-items-center","gap-2"],[1,"card-title","mb-0"],[1,"badge","rounded-pill","text-bg-info"],[1,"btn","btn-primary","d-flex","align-items-center",3,"click","disabled"],[1,"input-group"],[1,"input-group-text","border-end-0","text-muted"],["type","text","placeholder","Buscar por n\xFAmero de cuenta",1,"form-control","border-start-0","ps-0",3,"input"],[1,"card-body","p-2"],[1,"table-responsive"],[1,"table","table-borderless","align-middle"],[1,"mb-3","d-block"],[1,"card-footer","d-flex","flex-column","flex-md-row","gap-2","justify-content-between","align-items-center"],[1,"d-flex","justify-content-between","align-items-center","gap-2","w-100"],[1,"text-muted","small"],[3,"sizeChange","pageSize"],[3,"pageChange","collectionSize","page","pageSize"],[3,"selectCustomer","customer","isSelected"],[1,"bi","bi-person-exclamation","fs-4","d-block","mb-2"],[1,"spinner-border","spinner-border-sm"],["name","bootstrapPlusCircle",1,"me-0","me-sm-1"],[1,"d-none","d-sm-block"],[1,"p-0","w-100","d-block"],[3,"account"],[1,"text-center","py-5"]],template:function(n,e){n&1&&(r(0,"div",1)(1,"div",2)(2,"div",3)(3,"span",4),b(4,De,1,0,"div",5)(5,Ne,1,0,"ng-icon",6),c(),r(6,"input",7),p("input",function(d){return e.onCustomerSearch(d)}),c()(),r(7,"div",8),B(8,Ie,3,3,"div",null,ve,!1,Oe,3,0,"div",9),c()(),r(11,"div",10)(12,"div",11)(13,"div",12)(14,"div",13)(15,"div",14)(16,"h5",15),s(17,"Cuentas para: "),c(),r(18,"span",16),s(19),c()(),r(20,"button",17),p("click",function(){return e.createAccount()}),b(21,ke,3,0)(22,Pe,3,0),c()(),r(23,"div",18)(24,"span",19),u(25,"ng-icon",6),c(),r(26,"input",20),p("input",function(d){return e.onAccountSearch(d)}),c()()(),r(27,"div",21)(28,"div",22)(29,"table",23)(30,"thead")(31,"tr"),u(32,"th"),c()(),r(33,"tbody"),B(34,je,3,1,"tr",24,ve,!1,Re,4,1,"tr"),c()()()(),r(37,"div",25)(38,"div",26)(39,"div",27),s(40),te(41,"translate"),c(),r(42,"app-page-size-selector",28),p("sizeChange",function(d){return e.pageSize.set(d),e.loadAccounts()}),c()(),r(43,"ngb-pagination",29),p("pageChange",function(d){return e.page.set(d),e.loadAccounts()}),c()()()()()),n&2&&(a(4),f(e.isSearching()?4:5),a(4),H(e.customers()),a(11),S(e.selectedDocumentNumber()),a(),g("disabled",!e.selectedDocumentNumber()||e.isCreatingAccount()),a(),f(e.isCreatingAccount()?21:22),a(13),H(e.accounts()),a(6),k(" ",ne(41,12,"table.total_record")," ",e.totalItems()," "),a(2),g("pageSize",e.pageSize()),a(),g("collectionSize",e.totalItems())("page",e.page())("pageSize",e.pageSize()))},dependencies:[fe,he,z,U,F,ae],styles:[".customer-list-scroll[_ngcontent-%COMP%]{scroll-behavior:smooth;overflow-y:auto;max-height:80vh}@media (max-width: 990px){.customer-list-scroll[_ngcontent-%COMP%]{max-height:30vh}}.col-left[_ngcontent-%COMP%]{border-right:1px solid var(--color-separator)}@media (max-width: 990px){.col-left[_ngcontent-%COMP%]{border-right:none;border-bottom:1px solid var(--color-separator);padding-bottom:10px}}"]})};export{Se as AccountManagement};
